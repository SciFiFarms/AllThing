#!/usr/bin/env bash
. init.sh

# $1: The folder to generate a gitmodule for.
# $2: The location of the .gitmodules file.
add_module() {
    folder=${folder##*/}
    gitmodules_path=$2
    echo "[submodule \"$folder\"]" >> $gitmodules_path
    echo "path = services/$folder" >> $gitmodules_path
    echo "url = dummy_string_to_satisfy_vscode" >> $gitmodules_path
    echo "" >> $gitmodules_path
}

gitmodules_path=$TECHNOCORE_SERVICES/.gitmodules
echo "# Do not edit this file. It is generated by running \`technocore generate_gitmodules\`." > $gitmodules_path
echo "# It creates a module for each folder. This allows for different services to be present and visible in VS Code." >> $gitmodules_path

echo "[submodule \"repo-template\"]" >> $gitmodules_path
echo "path = repo-template" >> $gitmodules_path
echo "url = dummy_string_to_satisfy_vscode" >> $gitmodules_path
echo "" >> $gitmodules_path

echo "[submodule \"deploy\"]" >> $gitmodules_path
echo "path = deploy" >> $gitmodules_path
echo "url = dummy_string_to_satisfy_vscode" >> $gitmodules_path
echo "" >> $gitmodules_path

echo "[submodule \"data-esphome\"]" >> $gitmodules_path
echo "path = data/esphome" >> $gitmodules_path
echo "url = dummy_string_to_satisfy_vscode" >> $gitmodules_path
echo "" >> $gitmodules_path

for folder in $TECHNOCORE_SERVICES/*; do
    # Will not run if no directories are available
    # https://unix.stackexchange.com/questions/86722/how-do-i-loop-through-only-directories-in-bash
    if [ -d ${folder} ]; then
        folder=${folder##*/}
        echo "[submodule \"$folder\"]" >> $gitmodules_path
        echo "path = services/$folder" >> $gitmodules_path
        echo "url = dummy_string_to_satisfy_vscode" >> $gitmodules_path
        echo "" >> $gitmodules_path
    fi
done
